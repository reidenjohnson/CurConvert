<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Currency Converter</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body style="font-family: sans-serif; max-width: 600px; margin: 2rem auto;">
  <h1>Currency Converter</h1>
  <label>Amount:</label>
  <input type="number" id="amount" placeholder="Enter amount" />

  <label>From:</label>
  <select id="from">
    <option value="USD">USD</option>
    <option value="EUR">EUR</option>
    <option value="GBP">GBP</option>
    <option value="JPY">JPY</option>
    <option value="RUB">RUB</option>
  </select>

  <label>To:</label>
  <select id="to">
    <option value="USD">USD</option>
    <option value="EUR">EUR</option>
    <option value="GBP">GBP</option>
    <option value="JPY">JPY</option>
    <option value="RUB">RUB</option>
  </select>

  <button id="convertBtn">Convert</button>

  <div id="result" style="margin-top: 20px; font-weight: bold;"></div>

  <script>
    // Fetch exchange rates using axios
    async function getExchangeRates(base) {
      try {
        const response = await axios.get(`https://api.exchangerate-api.com/v4/latest/${base}`);
        if (response.data && response.data.rates) {
          return response.data.rates;
        } else {
          console.error("Invalid API response format.");
          return null;
        }
      } catch (error) {
        console.error("Error fetching rates:", error);
        return null;
      }
    }

    // Choosing conversions between currencies
    function convertCurrency(amount, from, to, rates) {
      if (!rates || !rates[to]) {
        console.error("Conversion rate not available.");
        return null;
      }
      return amount * rates[to];
    }

    // Display conversion result or failure message
    function displayResult(amount, from, to, result) {
      const resultDiv = document.getElementById("result");
      if (result === null) {
        resultDiv.textContent = "Conversion failed. Please try again.";
        return;
      }
      // String Operation combines the amount and currency
      resultDiv.textContent = `${amount} ${from} = ${result.toFixed(2)} ${to}`;
    }

    // Simple recursion: retry API fetch if it fails
    async function fetchWithRetry(base, retries = 3) {
      if (retries === 0) {
        console.error("All retries failed.");
        return null;
      }
      const rates = await getExchangeRates(base);
      if (rates) {
        return rates;
      }
      console.log(`Retrying... attempts left: ${retries - 1}`);
      return await fetchWithRetry(base, retries - 1); // recursive call
    }

    // Handle user clicking Convert button
    async function handleConvert() {
      const amount = parseFloat(document.getElementById("amount").value);
      const from = document.getElementById("from").value;
      const to = document.getElementById("to").value;
      
      // Input Validation
      if (isNaN(amount) || amount <= 0) {
        alert("Please enter a valid amount.");
        return;
      }
      // Fetch rates with recursion
      const rates = await fetchWithRetry(from); // now uses recursion for reliability
      if (!rates) {
        alert("Could not fetch exchange rates after multiple attempts.");
        return;
      }

      // Convert currency and then Display result
      const result = convertCurrency(amount, from, to, rates);
      displayResult(amount, from, to, result);

      // Use an ES6 array method just to demonstrate
      const popularCurrencies = ["USD", "EUR", "GBP", "JPY", "RUB"];
      const filtered = popularCurrencies.filter(c => c !== from);
      console.log("Other available currencies:", filtered.join(", "));
    }

    document.getElementById("convertBtn").addEventListener("click", handleConvert);
  </script>
</body>
</html>


